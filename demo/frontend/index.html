<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦å®åšå®¢ - çŸ¥è¯†åˆ†äº«å¹³å°</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ç«‹å³ç”Ÿæ•ˆçš„åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* å¯¼èˆªæ æ ·å¼ */
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            height: 60px;
        }
        
        .nav-logo .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            text-decoration: none;
        }
        
        .nav-logo .logo i {
            color: #3498db;
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .nav-link {
            color: #555;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            color: #3498db;
            background: #f8f9fa;
        }
        
        /* ğŸ”¥ æ–°å¢ï¼šç”¨æˆ·çŠ¶æ€åŒºåŸŸæ ·å¼ */
        .user-status-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* ç”¨æˆ·èœå•æ ·å¼ */
        .user-menu {
            position: relative;
            display: inline-block;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .user-info:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .user-name {
            font-weight: 500;
            color: #2c3e50;
            font-size: 14px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .user-info i {
            font-size: 12px;
            color: #7f8c8d;
            transition: transform 0.3s;
        }
        
        .user-info:hover i {
            transform: rotate(180deg);
        }
        
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            min-width: 180px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            margin-top: 5px;
            animation: fadeInDown 0.2s ease-out;
        }
        
        .dropdown-menu.show {
            display: block;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: #2c3e50;
            text-decoration: none;
            font-size: 14px;
            border-bottom: 1px solid #f8f9fa;
            transition: all 0.2s;
            gap: 8px;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
            color: #3498db;
        }
        
        .dropdown-item i {
            width: 16px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .dropdown-divider {
            height: 1px;
            background: #f8f9fa;
            margin: 5px 0;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ç™»å½•/æ³¨å†ŒæŒ‰é’®å®¹å™¨ */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-buttons .btn {
            font-size: 14px;
            padding: 8px 16px;
            transition: all 0.3s;
        }
        
        .auth-buttons .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        /* ç§»åŠ¨ç«¯èœå•æŒ‰é’® */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #555;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
        }
        
        .mobile-menu-btn:hover {
            background: #f8f9fa;
        }
        
        /* æœç´¢æ¡† */
        .search-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px 0;
            margin-bottom: 30px;
        }
        
        .search-box {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .btn-outline {
            background: white;
            color: #3498db;
            border: 1px solid #3498db;
        }
        
        .btn-outline:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
        }
        
        /* ä¸»è¦å†…å®¹ */
        .content-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .content-layout {
                grid-template-columns: 1fr;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .user-menu {
                width: 100%;
            }
            
            .user-info {
                justify-content: center;
            }
            
            .dropdown-menu {
                position: static;
                width: 100%;
                box-shadow: none;
                border: 1px solid #e9ecef;
                margin-top: 10px;
            }
        }
        
        /* æ–‡ç« ç½‘æ ¼ */
        .posts-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .post-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .post-title {
            margin: 0 0 10px 0;
            font-size: 1.3rem;
        }
        
        .post-title a {
            color: #2c3e50;
            text-decoration: none;
        }
        
        .post-title a:hover {
            color: #3498db;
        }
        
        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .post-excerpt {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        /* ä¾§è¾¹æ  */
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading-state {
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        /* é”™è¯¯çŠ¶æ€ */
        .error-state {
            text-align: center;
            padding: 40px 20px;
            color: #e74c3c;
        }
        
        .error-state i {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        /* é¡µè„š */
        .footer {
            background: #2c3e50;
            color: #fff;
            padding: 40px 0 20px;
            margin-top: 40px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .footer-section h4 {
            margin-bottom: 15px;
            color: white;
        }
        
        .footer-section a {
            color: #bdc3c7;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }
        
        .footer-section a:hover {
            color: #3498db;
        }
        
        .social-links {
            display: flex;
            gap: 10px;
        }
        
        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            color: white;
            font-size: 18px;
        }
        
        .social-links a:hover {
            background: #3498db;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #bdc3c7;
            font-size: 14px;
        }
        
        /* åˆ†é¡µ */
        .pagination-nav {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        
        .pagination {
            list-style: none;
            display: flex;
            gap: 5px;
        }
        
        .page-item {
            display: inline-block;
        }
        
        .page-link {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            color: #3498db;
            text-decoration: none;
            border-radius: 4px;
        }
        
        .page-item.active .page-link {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .page-link:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html" class="logo">
                    <i class="fas fa-book-open"></i> å­¦å®åšå®¢
                </a>
            </div>
            
            <div class="nav-menu">
                <a href="index.html" class="nav-link active">
                    <i class="fas fa-home"></i> é¦–é¡µ
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-th"></i> åˆ†ç±»
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-tags"></i> æ ‡ç­¾
                </a>
                <a href="about.html" class="nav-link">
                    <i class="fas fa-info-circle"></i> å…³äº
                </a>
                
                <!-- ğŸ”¥ ä¿®æ”¹ï¼šç”¨æˆ·çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
                <div class="user-status-area">
                    <!-- æœªç™»å½•çŠ¶æ€ - ç™»å½•/æ³¨å†ŒæŒ‰é’® -->
                    <div id="guestView" class="auth-buttons">
                        <a href="login.html" class="btn btn-outline">ç™»å½•</a>
                        <a href="register.html" class="btn btn-primary">æ³¨å†Œ</a>
                    </div>
                    
                    <!-- å·²ç™»å½•çŠ¶æ€ - ç”¨æˆ·èœå• -->
                    <div id="loggedInView" class="user-menu" style="display: none;">
                        <div class="user-info" onclick="UserManager.toggleUserMenu()">
                            <div class="user-avatar" id="userAvatar">ğŸ‘¤</div>
                            <span class="user-name" id="userName">ç”¨æˆ·</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="userDropdownMenu">
                            <a href="profile.html" class="dropdown-item">
                                <i class="fas fa-user-circle"></i> ä¸ªäººä¸­å¿ƒ
                            </a>
                            <a href="my-posts.html" class="dropdown-item">
                                <i class="fas fa-file-alt"></i> æˆ‘çš„æ–‡ç« 
                            </a>
                            <a href="create-post.html" class="dropdown-item">
                                <i class="fas fa-edit"></i> å†™æ–‡ç« 
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="javascript:void(0)" class="dropdown-item" onclick="UserManager.switchUser()">
                                <i class="fas fa-exchange-alt"></i> åˆ‡æ¢ç”¨æˆ·
                            </a>
                            <a href="javascript:void(0)" class="dropdown-item" onclick="UserManager.logout()">
                                <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
            <button class="mobile-menu-btn" onclick="UserManager.toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- æœç´¢æ¡† -->
    <section class="search-section">
        <div class="container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢æ–‡ç« ..." class="search-input">
                <button class="btn btn-primary" id="searchButton" onclick="App.searchPosts()">
                    <i class="fas fa-search"></i> æœç´¢
                </button>
            </div>
        </div>
    </section>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container">
        <div class="content-layout">
            <!-- å·¦ä¾§ï¼šæ–‡ç« åˆ—è¡¨ -->
            <div class="main-content">
                <div class="page-header">
                    <h1>æœ€æ–°æ–‡ç« </h1>
                    <div class="filter-buttons">
                        <button class="btn btn-outline active" onclick="App.goToPage(0)">å…¨éƒ¨</button>
                        <button class="btn btn-outline" onclick="App.goToPage(0, 'popular')">çƒ­é—¨</button>
                        <button class="btn btn-outline" onclick="App.goToPage(0, 'latest')">æœ€æ–°</button>
                    </div>
                </div>

                <div class="posts-container" id="postsContainer">
                    <!-- æ–‡ç« åˆ—è¡¨åŠ¨æ€åŠ è½½ -->
                </div>

                <!-- åˆ†é¡µ -->
                <div class="pagination" id="pagination">
                    <!-- åˆ†é¡µæŒ‰é’®åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å³ä¾§ï¼šä¾§è¾¹æ  -->
            <aside class="sidebar">
                <!-- ğŸ”¥ ä¿®æ”¹ï¼šç”¨æˆ·çŠ¶æ€å¡ç‰‡ -->
                <div id="userCard" class="card auth-card" style="display: none;">
                    <h3 id="userCardTitle">ä¸ªäººä¸­å¿ƒ</h3>
                    <p id="userCardWelcome">æ¬¢è¿å›æ¥ï¼</p>
                    <a href="create-post.html" class="btn btn-primary btn-block">å†™æ–‡ç« </a>
                    <a href="my-posts.html" class="btn btn-outline btn-block">æˆ‘çš„æ–‡ç« </a>
                    <a href="javascript:void(0)" class="btn btn-link btn-block" onclick="UserManager.switchUser()" id="userCardSwitch">åˆ‡æ¢ç”¨æˆ·</a>
                </div>
                
                <!-- ç™»å½•/æ³¨å†Œå¡ç‰‡ï¼ˆæœªç™»å½•çŠ¶æ€ï¼‰ -->
                <div id="authCard" class="card auth-card">
                    <h3>åŠ å…¥å­¦å®åšå®¢</h3>
                    <p>åˆ†äº«çŸ¥è¯†ï¼Œå…±åŒæˆé•¿</p>
                    <a href="login.html" class="btn btn-primary btn-block">ç™»å½•</a>
                    <a href="register.html" class="btn btn-outline btn-block">æ³¨å†Œ</a>
                </div>

                <!-- åˆ†ç±» -->
                <div class="card categories">
                    <h3>æ–‡ç« åˆ†ç±»</h3>
                    <ul class="category-list" id="categoryList">
                        <li><a href="#">å‰ç«¯å¼€å‘</a></li>
                        <li><a href="#">åç«¯å¼€å‘</a></li>
                        <li><a href="#">ç§»åŠ¨å¼€å‘</a></li>
                        <li><a href="#">äººå·¥æ™ºèƒ½</a></li>
                        <li><a href="#">æ•°æ®åº“</a></li>
                    </ul>
                </div>

                <!-- çƒ­é—¨æ ‡ç­¾ -->
                <div class="card tags">
                    <h3>çƒ­é—¨æ ‡ç­¾</h3>
                    <div class="tag-list" id="tagList">
                        <span class="tag">JavaScript</span>
                        <span class="tag">Python</span>
                        <span class="tag">Java</span>
                        <span class="tag">React</span>
                        <span class="tag">Vue</span>
                        <span class="tag">Node.js</span>
                        <span class="tag">Spring</span>
                        <span class="tag">MySQL</span>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>å­¦å®åšå®¢</h4>
                    <p>åˆ†äº«çŸ¥è¯†ï¼Œå…±åŒæˆé•¿çš„æŠ€æœ¯ç¤¾åŒº</p>
                </div>
                <div class="footer-section">
                    <h4>é“¾æ¥</h4>
                    <a href="index.html">é¦–é¡µ</a>
                    <a href="about.html">å…³äºæˆ‘ä»¬</a>
                    <a href="contact.html">è”ç³»æˆ‘ä»¬</a>
                </div>
                <div class="footer-section">
                    <h4>å…³æ³¨æˆ‘ä»¬</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-github"></i></a>
                        <a href="#"><i class="fab fa-weibo"></i></a>
                        <a href="#"><i class="fab fa-weixin"></i></a>
                    </div>
                </div>
            </div>
            <p class="copyright">Â© 2023 å­¦å®åšå®¢. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>

    <!-- å¿…é¡»æŒ‰æ­£ç¡®é¡ºåºåŠ è½½ -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script><!-- ğŸ”¥ æ–°å¢ï¼šç”¨æˆ·çŠ¶æ€ç®¡ç† -->
    <script>
        // ç”¨æˆ·çŠ¶æ€ç®¡ç†å™¨
        class UserManager {
            // åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€
            static init() {
                console.log('ğŸ‘¤ UserManager åˆå§‹åŒ–...');
                this.updateUserStatus();
                this.bindEvents();
            }
            
            // æ›´æ–°ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º
            static updateUserStatus() {
                console.log('ğŸ”„ æ›´æ–°ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º...');
                
                const token = localStorage.getItem('xuebao_token');
                const userStr = localStorage.getItem('xuebao_user');
                
                console.log('æœ¬åœ°å­˜å‚¨æ£€æŸ¥:');
                console.log('- token:', token ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
                console.log('- userStr:', userStr ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
                
                if (token && userStr) {
                    try {
                        const user = JSON.parse(userStr);
                        const username = user.username || user.email || 'ç”¨æˆ·';
                        const firstLetter = username.charAt(0).toUpperCase();
                        
                        console.log('âœ… ç”¨æˆ·å·²ç™»å½•:', username);
                        
                        // æ›´æ–°å¯¼èˆªæ 
                        const guestView = document.getElementById('guestView');
                        const loggedInView = document.getElementById('loggedInView');
                        
                        if (guestView && loggedInView) {
                            guestView.style.display = 'none';
                            loggedInView.style.display = 'block';
                            console.log('âœ… å¯¼èˆªæ å·²æ›´æ–°');
                        }
                        
                        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                        const userAvatar = document.getElementById('userAvatar');
                        const userName = document.getElementById('userName');
                        
                        if (userAvatar) {
                            userAvatar.textContent = firstLetter;
                            console.log('âœ… ç”¨æˆ·å¤´åƒå·²æ›´æ–°:', firstLetter);
                        }
                        if (userName) {
                            userName.textContent = username;
                            console.log('âœ… ç”¨æˆ·åå·²æ›´æ–°:', username);
                        }
                        
                        // æ›´æ–°ä¾§è¾¹æ å¡ç‰‡
                        const userCard = document.getElementById('userCard');
                        const authCard = document.getElementById('authCard');
                        
                        if (userCard) {
                            const title = document.getElementById('userCardTitle');
                            const welcome = document.getElementById('userCardWelcome');
                            
                            if (title) title.textContent = username;
                            if (welcome) welcome.textContent = 'æ¬¢è¿å›æ¥ï¼';
                            userCard.style.display = 'block';
                            console.log('âœ… ç”¨æˆ·å¡ç‰‡å·²æ˜¾ç¤º');
                        }
                        
                        if (authCard) {
                            authCard.style.display = 'none';
                            console.log('âœ… ç™»å½•å¡ç‰‡å·²éšè—');
                        }
                        
                        console.log('âœ… ç”¨æˆ·çŠ¶æ€æ›´æ–°å®Œæˆ');
                        
                    } catch (error) {
                        console.error('âŒ è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                        this.showGuestState();
                    }
                } else {
                    console.log('ğŸ‘¤ ç”¨æˆ·æœªç™»å½•');
                    this.showGuestState();
                }
            }
            
            // æ˜¾ç¤ºè®¿å®¢çŠ¶æ€
            static showGuestState() {
                console.log('ğŸ“± æ˜¾ç¤ºè®¿å®¢çŠ¶æ€');
                
                const guestView = document.getElementById('guestView');
                const loggedInView = document.getElementById('loggedInView');
                const userCard = document.getElementById('userCard');
                const authCard = document.getElementById('authCard');
                
                if (guestView && loggedInView) {
                    guestView.style.display = 'flex';
                    loggedInView.style.display = 'none';
                    console.log('âœ… å¯¼èˆªæ æ˜¾ç¤ºè®¿å®¢çŠ¶æ€');
                }
                
                if (userCard) {
                    userCard.style.display = 'none';
                    console.log('âœ… ç”¨æˆ·å¡ç‰‡å·²éšè—');
                }
                
                if (authCard) {
                    authCard.style.display = 'block';
                    console.log('âœ… ç™»å½•å¡ç‰‡å·²æ˜¾ç¤º');
                }
            }
            
            // åˆ‡æ¢ç”¨æˆ·èœå•
            static toggleUserMenu() {
                console.log('ğŸ“‹ åˆ‡æ¢ç”¨æˆ·èœå•');
                const dropdown = document.getElementById('userDropdownMenu');
                if (dropdown) {
                    dropdown.classList.toggle('show');
                    
                    // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­
                    document.addEventListener('click', function closeMenu(e) {
                        if (!e.target.closest('.user-menu')) {
                            dropdown.classList.remove('show');
                            document.removeEventListener('click', closeMenu);
                        }
                    });
                }
            }
            
            // åˆ‡æ¢ç”¨æˆ·
            static switchUser() {
                console.log('ğŸ”„ åˆ‡æ¢ç”¨æˆ·');
                
                if (confirm('ç¡®å®šè¦åˆ‡æ¢ç”¨æˆ·å—ï¼Ÿå½“å‰ç”¨æˆ·å°†é€€å‡ºç™»å½•ã€‚')) {
                    localStorage.removeItem('xuebao_token');
                    localStorage.removeItem('xuebao_user');
                    
                    if (window.Utils && typeof Utils.showMessage === 'function') {
                        Utils.showMessage('æ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µé¢...', 'info');
                    }
                    
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1000);
                }
            }
            
            // é€€å‡ºç™»å½•
            static logout() {
                console.log('ğŸšª é€€å‡ºç™»å½•');
                if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                    localStorage.removeItem('xuebao_token');
                    localStorage.removeItem('xuebao_user');
                    
                    if (window.Utils && typeof Utils.showMessage === 'function') {
                        Utils.showMessage('å·²é€€å‡ºç™»å½•', 'success');
                    }
                    
                    // åˆ·æ–°é¡µé¢
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                }
            }
            
            // ç»‘å®šäº‹ä»¶
            static bindEvents() {
                console.log('ğŸ”— ç»‘å®šç”¨æˆ·äº‹ä»¶...');
                
                // æœç´¢åŠŸèƒ½
                const searchInput = document.getElementById('searchInput');
                const searchButton = document.getElementById('searchButton');
                
                if (searchInput) {
                    searchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            if (window.App && typeof App.searchPosts === 'function') {
                                App.searchPosts();
                            }
                        }
                    });
                }
                
                if (searchButton) {
                    searchButton.addEventListener('click', () => {
                        if (window.App && typeof App.searchPosts === 'function') {
                            App.searchPosts();
                        }
                    });
                }
                
                // ç§»åŠ¨ç«¯èœå•
                const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
                if (mobileMenuBtn) {
                    mobileMenuBtn.addEventListener('click', this.toggleMobileMenu);
                }
                
                console.log('âœ… ç”¨æˆ·äº‹ä»¶ç»‘å®šå®Œæˆ');
            }
            
            // åˆ‡æ¢ç§»åŠ¨ç«¯èœå•
            static toggleMobileMenu() {
                console.log('ğŸ“± åˆ‡æ¢ç§»åŠ¨ç«¯èœå•');
                const navMenu = document.querySelector('.nav-menu');
                if (navMenu) {
                    navMenu.classList.toggle('active');
                }
            }
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            static checkLoginStatus() {
                const token = localStorage.getItem('xuebao_token');
                const userStr = localStorage.getItem('xuebao_user');
                
                console.log('ğŸ” æ£€æŸ¥ç™»å½•çŠ¶æ€:');
                console.log('- Tokenå­˜åœ¨:', !!token);
                console.log('- ç”¨æˆ·ä¿¡æ¯å­˜åœ¨:', !!userStr);
                
                if (token && userStr) {
                    try {
                        const user = JSON.parse(userStr);
                        return {
                            isLoggedIn: true,
                            user: user,
                            username: user.username || user.email || 'ç”¨æˆ·'
                        };
                    } catch (error) {
                        console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                        return { isLoggedIn: false };
                    }
                }
                return { isLoggedIn: false };
            }
        }
        
        // å…¨å±€å¯¼å‡º
        window.UserManager = UserManager;
        
        // ğŸ”¥ å…³é”®ä¿®å¤ï¼šé¡µé¢åŠ è½½å®Œæˆåç«‹å³åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ‰ é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€...');
            
            // ğŸ”¥ ç¬¬ä¸€æ­¥ï¼šç«‹å³æ£€æŸ¥ç™»å½•çŠ¶æ€
            console.log('ğŸ” ç«‹å³æ£€æŸ¥ç™»å½•çŠ¶æ€...');
            const token = localStorage.getItem('xuebao_token');
            const userStr = localStorage.getItem('xuebao_user');
            
            console.log('æœ¬åœ°å­˜å‚¨ä¿¡æ¯:');
            console.log('xuebao_token:', token ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
            console.log('xuebao_user:', userStr ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
            
            if (token && userStr) {
                try {
                    const user = JSON.parse(userStr);
                    console.log('âœ… ç”¨æˆ·å·²ç™»å½•:', user);
                    console.log('ç”¨æˆ·å:', user.username || user.email || 'ç”¨æˆ·');
                    
                    // ğŸ”¥ ç«‹å³æ›´æ–°ç”¨æˆ·ç•Œé¢
                    console.log('ğŸš€ ç«‹å³æ›´æ–°ç”¨æˆ·ç•Œé¢...');
                    updateUserStatusImmediately();
                    
                } catch (error) {
                    console.error('âŒ è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                }
            } else {
                console.log('ğŸ‘¤ ç”¨æˆ·æœªç™»å½•');
            }
            
            // ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–ç”¨æˆ·ç®¡ç†å™¨
            if (window.UserManager && typeof UserManager.init === 'function') {
                UserManager.init();
            } else {
                console.error('âŒ UserManager.init ä¸å­˜åœ¨');
            }
            
            // ç¬¬ä¸‰æ­¥ï¼šç»‘å®šæœç´¢äº‹ä»¶
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        if (window.App && typeof App.searchPosts === 'function') {
                            App.searchPosts();
                        }
                    }
                });
            }
            
            // ç¬¬å››æ­¥ï¼šè‡ªåŠ¨åŠ è½½æ–‡ç« 
            setTimeout(() => {
                const postsContainer = document.getElementById('postsContainer');
                if (postsContainer && postsContainer.innerHTML.trim() === '') {
                    console.log('æ£€æµ‹åˆ°æ–‡ç« å®¹å™¨ä¸ºç©ºï¼Œå°è¯•åŠ è½½...');
                    if (window.App && window.App.loadPosts) {
                        window.App.loadPosts();
                    }
                }
            }, 2000);
        });
        
        // ğŸ”¥ æ–°å¢ï¼šç«‹å³æ›´æ–°ç”¨æˆ·çŠ¶æ€çš„å‡½æ•°
        function updateUserStatusImmediately() {
            console.log('ğŸš€ ç«‹å³æ›´æ–°ç”¨æˆ·çŠ¶æ€...');
            
            const token = localStorage.getItem('xuebao_token');
            const userStr = localStorage.getItem('xuebao_user');
            
            if (token && userStr) {
                try {
                    const user = JSON.parse(userStr);
                    const username = user.username || user.email || 'ç”¨æˆ·';
                    const firstLetter = username.charAt(0).toUpperCase();
                    
                    console.log(`âœ… ç”¨æˆ·å·²ç™»å½•: ${username}`);
                    
                    // æŸ¥æ‰¾ç›¸å…³å…ƒç´ 
                    const guestView = document.getElementById('guestView');
                    const loggedInView = document.getElementById('loggedInView');
                    const userAvatar = document.getElementById('userAvatar');
                    const userName = document.getElementById('userName');
                    const userCard = document.getElementById('userCard');
                    const authCard = document.getElementById('authCard');
                    
                    console.log('æ‰¾åˆ°çš„DOMå…ƒç´ :');
                    console.log('- guestView:', !!guestView);
                    console.log('- loggedInView:', !!loggedInView);
                    console.log('- userAvatar:', !!userAvatar);
                    console.log('- userName:', !!userName);
                    console.log('- userCard:', !!userCard);
                    console.log('- authCard:', !!authCard);
                    
                    // æ›´æ–°å¯¼èˆªæ 
                    if (guestView) {
                        guestView.style.display = 'none';
                        console.log('âœ… éšè—è®¿å®¢è§†å›¾');
                    }
                    if (loggedInView) {
                        loggedInView.style.display = 'block';
                        console.log('âœ… æ˜¾ç¤ºç™»å½•è§†å›¾');
                    }
                    if (userAvatar) {
                        userAvatar.textContent = firstLetter;
                        console.log('âœ… æ›´æ–°ç”¨æˆ·å¤´åƒ:', firstLetter);
                    }
                    if (userName) {
                        userName.textContent = username;
                        console.log('âœ… æ›´æ–°ç”¨æˆ·å:', username);
                    }
                    
                    // æ›´æ–°ä¾§è¾¹æ å¡ç‰‡
                    if (userCard) {
                        const title = userCard.querySelector('h3') || document.getElementById('userCardTitle');
                        const welcome = userCard.querySelector('p') || document.getElementById('userCardWelcome');
                        
                        if (title) {
                            title.textContent = username;
                            console.log('âœ… æ›´æ–°ç”¨æˆ·å¡ç‰‡æ ‡é¢˜:', username);
                        }
                        if (welcome) {
                            welcome.textContent = 'æ¬¢è¿å›æ¥ï¼';
                            console.log('âœ… æ›´æ–°æ¬¢è¿ä¿¡æ¯');
                        }
                        userCard.style.display = 'block';
                        console.log('âœ… æ˜¾ç¤ºç”¨æˆ·å¡ç‰‡');
                    }
                    
                    if (authCard) {
                        authCard.style.display = 'none';
                        console.log('âœ… éšè—ç™»å½•å¡ç‰‡');
                    }
                    
                    console.log('âœ… ç”¨æˆ·ç•Œé¢å·²æ›´æ–°');
                    
                } catch (error) {
                    console.error('âŒ æ›´æ–°ç”¨æˆ·ç•Œé¢å¤±è´¥:', error);
                }
            } else {
                console.log('ğŸ‘¤ ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºè®¿å®¢çŠ¶æ€');
                
                const guestView = document.getElementById('guestView');
                const loggedInView = document.getElementById('loggedInView');
                const userCard = document.getElementById('userCard');
                const authCard = document.getElementById('authCard');
                
                if (guestView) guestView.style.display = 'flex';
                if (loggedInView) loggedInView.style.display = 'none';
                if (userCard) userCard.style.display = 'none';
                if (authCard) authCard.style.display = 'block';
                
                console.log('âœ… è®¿å®¢çŠ¶æ€å·²è®¾ç½®');
            }
        }
        
        // å…¨å±€åˆ·æ–°é¡µé¢å‡½æ•°
        window.refreshPage = function() {
            location.reload();
        };
        
        // å…¨å±€åŠ è½½å‡½æ•°
        window.loadArticles = function() {
            if (window.App && window.App.loadPosts) {
                window.App.loadPosts();
            } else {
                console.error('App.loadPosts ä¸å­˜åœ¨');
                alert('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        };
        
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMobileMenu() {
            const navMenu = document.querySelector('.nav-menu');
            if (navMenu) navMenu.classList.toggle('active');
        }
        
        // é¡µé¢å®Œå…¨åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            console.log('âœ… é¡µé¢å®Œå…¨åŠ è½½å®Œæˆ');
            console.log('å…¨å±€å¯¹è±¡æ£€æŸ¥:');
            console.log('- window.API:', window.API ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
            console.log('- window.API.getPosts:', typeof window.API?.getPosts);
            console.log('- window.App:', window.App ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
            console.log('- window.App.loadPosts:', typeof window.App?.loadPosts);
            console.log('- window.UserManager:', window.UserManager ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
            
            // æœ€ç»ˆæ£€æŸ¥ç”¨æˆ·çŠ¶æ€
            if (window.UserManager && typeof UserManager.checkLoginStatus === 'function') {
                const loginStatus = UserManager.checkLoginStatus();
                console.log('æœ€ç»ˆç™»å½•çŠ¶æ€:', loginStatus);
            }
            
            // æœ€ç»ˆæ£€æŸ¥ç”¨æˆ·ç•Œé¢çŠ¶æ€
            console.log('ç”¨æˆ·ç•Œé¢å…ƒç´ æ£€æŸ¥:');
            console.log('- guestViewæ˜¾ç¤º:', document.getElementById('guestView')?.style.display);
            console.log('- loggedInViewæ˜¾ç¤º:', document.getElementById('loggedInView')?.style.display);
            console.log('- userCardæ˜¾ç¤º:', document.getElementById('userCard')?.style.display);
            console.log('- authCardæ˜¾ç¤º:', document.getElementById('authCard')?.style.display);
            
            // ğŸ”¥ æœ€ç»ˆå¼ºåˆ¶æ›´æ–°ï¼šå¦‚æœæ²¡æœ‰æ­£ç¡®æ˜¾ç¤ºï¼Œæ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°ä¸€æ¬¡
            const token = localStorage.getItem('xuebao_token');
            const userStr = localStorage.getItem('xuebao_user');
            if (token && userStr) {
                console.log('æœ‰ç™»å½•ä¿¡æ¯ï¼Œå†æ¬¡æ‰‹åŠ¨æ›´æ–°ç”¨æˆ·ç•Œé¢...');
                
                try {
                    const user = JSON.parse(userStr);
                    const username = user.username || user.email || 'ç”¨æˆ·';
                    const firstLetter = username.charAt(0).toUpperCase();
                    
                    const guestView = document.getElementById('guestView');
                    const loggedInView = document.getElementById('loggedInView');
                    const userAvatar = document.getElementById('userAvatar');
                    const userName = document.getElementById('userName');
                    const userCard = document.getElementById('userCard');
                    const authCard = document.getElementById('authCard');
                    
                    if (guestView) guestView.style.display = 'none';
                    if (loggedInView) loggedInView.style.display = 'block';
                    if (userAvatar) userAvatar.textContent = firstLetter;
                    if (userName) userName.textContent = username;
                    if (userCard) {
                        const title = document.getElementById('userCardTitle');
                        const welcome = document.getElementById('userCardWelcome');
                        if (title) title.textContent = username;
                        if (welcome) welcome.textContent = 'æ¬¢è¿å›æ¥ï¼';
                        userCard.style.display = 'block';
                    }
                    if (authCard) authCard.style.display = 'none';
                    
                    console.log('âœ… æœ€ç»ˆæ‰‹åŠ¨æ›´æ–°å®Œæˆï¼Œåº”æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯');
                } catch (error) {
                    console.error('æœ€ç»ˆæ‰‹åŠ¨æ›´æ–°å¤±è´¥:', error);
                }
            }
        });
        
        console.log('âœ… index.html JavaScriptåŠ è½½å®Œæˆ');
    </script>
</body>
</html>